---
// MusicPlayer.astro - éŸ³ä¹ç‚¹æ’­å®¤ç»„ä»¶
// æ”¯æŒç½‘æ˜“äº‘å®˜æ–¹å¤–é“¾ + æœåŠ¡å™¨éŸ³ä¹æ’­æ”¾

// é…ç½®æœåŠ¡å™¨éŸ³ä¹æ–‡ä»¶ï¼ˆæ”¾ public/music/ ç›®å½•ï¼‰
const serverMusic = [
  { file: 'song1.mp3', title: 'ç¨»é¦™ - å‘¨æ°ä¼¦' },
  { file: 'song2.mp3', title: 'æ™´å¤© - å‘¨æ°ä¼¦' },
  // æ·»åŠ æ›´å¤šæ­Œæ›²
];
---

<style>
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; margin: 32px 0; }
  .card { border-radius: 16px; padding: 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
  .gradient1 { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
  .gradient2 { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
  .white { background: white; }
  input, button { width: 100%; padding: 14px; margin: 16px 0 0; border-radius: 12px; border: none; font-size: 1em; }
  button { background: rgba(255,255,255,0.25); color: white; cursor: pointer; font-weight: bold; }
  #server-list > div { padding: 12px; background: rgba(255,255,255,0.2); border-radius: 8px; margin: 8px 0; cursor: pointer; }
  #server-list > div:hover { background: rgba(255,255,255,0.4); }
</style>

<div class="grid">

  <!-- ç½‘æ˜“äº‘ç‚¹æ­Œ -->
  <div class="card gradient1">
    <h2>ğŸµ ç½‘æ˜“äº‘ç‚¹æ­Œ</h2>
    <p>ç²˜è´´ç½‘æ˜“äº‘æ­Œæ›²é“¾æ¥ï¼ˆå…¬å¼€æ­Œæ›²å³å¯æ’­æ”¾ï¼‰</p>
    <input type="text" id="song-url" placeholder="ç²˜è´´æ­Œæ›²é“¾æ¥...">
    <button onclick="loadSong()">åŠ è½½æ’­æ”¾</button>
    <div id="status"></div>
  </div>

  <!-- æœåŠ¡å™¨æ­Œå• -->
  <div class="card gradient2">
    <h2>ğŸ¶ æœ¬ç«™æ­Œå•</h2>
    <p>ç‚¹å‡»ç›´æ¥æ’­æ”¾æœåŠ¡å™¨éŸ³ä¹æ–‡ä»¶</p>
    <div id="server-list"></div>
  </div>

  <!-- æ’­æ”¾å™¨ -->
  <div class="card white">
    <h3>â™ª å½“å‰æ­Œæ›²</h3>
    <p id="song-title">æš‚æ— æ­Œæ›²</p>
    <iframe id="netease-player" style="display:none;"></iframe>
    <audio id="server-player" controls></audio>
  </div>

</div>

<script>
  // æ¸²æŸ“æœåŠ¡å™¨æ­Œå•
  const list = document.getElementById('server-list');
  const songs = [{file: 'song1.mp3', title: 'ç¨»é¦™ - å‘¨æ°ä¼¦'}, {file: 'song2.mp3', title: 'æ™´å¤© - å‘¨æ°ä¼¦'}]; // ä» props ä¼ æˆ–ç¡¬ç¼–ç 
  songs.forEach(s => {
    const div = document.createElement('div');
    div.textContent = s.title;
    div.onclick = () => playServer(s.file, s.title);
    list.appendChild(div);
  });

  function playServer(file, title) {
    const p = document.getElementById('server-player');
    const n = document.getElementById('netease-player');
    const t = document.getElementById('song-title');
    p.src = `/music/${file}`;
    p.style.display = 'block';
    n.style.display = 'none';
    t.textContent = title + 'ï¼ˆæœåŠ¡å™¨æ–‡ä»¶ï¼‰';
    p.play();
  }

  function loadSong() {
    const input = document.getElementById('song-url').value.trim();
    const status = document.getElementById('status');
    const title = document.getElementById('song-title');
    const p = document.getElementById('netease-player');
    const sp = document.getElementById('server-player');

    const match = input.match(/id=(\d+)/);
    if (!match) {
      status.textContent = 'é“¾æ¥æ ¼å¼é”™è¯¯';
      status.style.color = '#ef4444';
      return;
    }

    const id = match[1];
    status.textContent = 'åŠ è½½ä¸­...';
    p.src = `https://music.163.com/outchain/player?type=2&id=${id}&auto=1&height=66`;
    p.style.display = 'block';
    sp.style.display = 'none';
    title.textContent = 'ç½‘æ˜“äº‘æ­Œæ›²æ’­æ”¾ä¸­';
    status.textContent = 'åŠ è½½æˆåŠŸ';
    status.style.color = '#22c55e';
  }
</script>